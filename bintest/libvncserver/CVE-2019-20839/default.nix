with import ../../common/pkgs.nix {};
let
  mylib = with_debug (
    (
      pkgs2003.libvncserver.override {
        systemd = null;
        libgcrypt = null;
      }
    ).overrideAttrs (
      old: {
        NIX_CFLAGS_COMPILE = "-fstack-protector-strong";
      }
    )
  );
in
with_debug ((pkgs2003.x11vnc.override { libvncserver = mylib; }).overrideAttrs (
  old: {
    preConfigure = old.preConfigure or "" + ''
      export NIX_CFLAGS_LINK="$NIX_CFLAGS_LINK $($PKG_CONFIG --libs --static x11 openssl zlib) -ljpeg -lpng"
      echo "NIX_CFLAGS_LINK=$NIX_CFLAGS_LINK"
    '';
  }
))
